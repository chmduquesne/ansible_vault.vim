Execute(Plugin loads):
  Assert exists('g:loaded_ansible_vault_auto')


Execute(Vault file decrypts at read time):

  execute 'edit test/fixtures/vault.yml'
  " SafeState never triggers with vader, we have to trigger it manually
  doautocmd SafeState

  let line = getline(1)

  let plain_yml = readfile('test/fixtures/plain.yml')
  let plain_line = plain_yml[0]

  " Buffer should now contain decrypted plain_yml
  Assert line ==# plain_line

  bwipeout!

Execute (New vault file encrypts at write time):

  execute 'edit test/fixtures/new_vault.yml'

  call setline(1, 'secret_key: supersecret')

  write

  bwipeout!

  " Re-open raw file without plugin interfering
  let content = readfile('test/fixtures/new_vault.yml')

  Assert content[0] =~ '^\$ANSIBLE_VAULT'

  call delete('test/fixtures/new_vault.yml')
